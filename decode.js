var crypto = require("./crypto")
  , BigNumber = require("./bignumber")
  , rsa = require("./rsa")
  , variants = [
    ["344572667627327574872986520507", "303498613397661458186613409505", "42393687358080034300726554172"],
    ["374446690081577726518750680131", "227308426243091608838383020209", "173544927178205874489521719542"],
    ["2015638500984252513380255580199", "1118845478227818565358376981641", "1968403772706991943140704820969"],
    ["2803016870163537170844910120589", "321029592955180891096364204933", "14592629850394393337941666131"],
    ["801354636919526323408669959133", "5357133285262456827514698587", "630839280032278632036025925797"],
    ["875078015194165779807004996891", "3317761452838260724386723229", "736612590537995601962451694817"],
    ["2945551046056896373232621994521", "1578240369330316947030869051291", "2268046305917896117885320940385"],
    ["342009136322315980094889308153", "208882210355060386981711608527", "323071158829636363902958789743"],
    ["1204053537389703721541732260277", "861912432659932141657251942349", "536925649708611072738514452088"],
    ["54532674247289454314563008683", "11477646364080609704857416529", "43355907199058798176130579652"],
    ["4442502401588849632243368606511", "1190181981555380137698609038857", "2194663810499391809566551485933"],
    ["88008953914041855699205104599", "47229555628553041136830405571", "47407773157716183186429902491"],
    ["86892104384358621580698011597", "26398962489114266337226913921", "62873526787664405062856709109"],
    ["279987870740665381618843285073", "118086993812917654371624726349", "162836163952303018366729425385"],
    ["1441006610206833289007830556447", "1102261365739821522530333068003", "694624368581721113652509149602"],
    ["310006596248373369847685371499", "131417437022740390789727023183", "73207463908856286134350964021"],
    ["412950519942098514204399552799", "34343127213212244935444124191", "221300658194014757382986496783"],
    ["1303470844272911466854652379811", "621046881056292008081324361643", "1157594636053203376021925344632"],
    ["365986541659725380455392101587", "345463653468664133151171563183", "227618660835758378742072466215"],
    ["3261434502421303279323564402143", "2939271343282951673253104740745", "1729120759169116226435526469188"],
    ["880256638333804972652092375741", "679965420900654922416860968339", "797932992062154509068500137757"],
    ["5087308846537040504749735052677", "635964111226216674951775514511", "3009767917863379873938622968631"],
    ["59824481984506504151410133849", "9396366867643299157738812133", "38815413112101541429153780760"],
    ["345643290359673252210751286509", "42230327764300114870970880547", "100986129396953142858650179714"],
    ["240719707794161389931571470417", "1594459547134895900616767861", "214377409021092070327230236385"],
    ["2382108426543348401296729081237", "1154894534459475385454702210381", "1273370590783719809245106145607"],
    ["329814218084908451102237952889", "66076832588057025959339642363", "114675515992271270646220477408"],
    ["1375719758603974834448145016229", "786912904386116647910035357501", "438444967054424668764166860047"],
    ["1255621015589767357963616484373", "1229439078303093414729367665997", "6707128251645275107007709510"],
    ["4503580535302153411490266610041", "1189393447683752946756622398941", "2570503345929776816031645086354"],
    ["1627040944314653910634318496023", "180426666459182597612758185881", "390704174174367535084038714741"],
    ["3576943277408979005059757821217", "3482204036556926093749575408709", "1123015711801071636107843562874"],
    ["3260730192713051360762140398937", "1208481207980698001137312191587", "1355838234634039892969275383829"],
    ["2982927654040643617168221295807", "2873746014960179413091709562637", "476789675161565579480825665424"],
    ["274367968163392106602848256127", "154899187893923739338714676739", "64572423133411071142293616868"],
    ["1759704387935284899984083501633", "1668350266552664908136290878215", "101826364771542867589783519268"],
    ["50521984138040381699131985921", "1662206736409154854019667059", "9132458113454720873580260016"],
    ["2887972237802982718212271315873", "157998649488421547233695490521", "1996567031029429901473983017849"],
    ["2787714501387687333564375076367", "299520927037692620509634283853", "2081392748597597074193254643883"],
    ["73251552185971008095619995381", "11990006860577370723253958291", "13067984531505580476221665929"],
    ["2143329688117157614570671479917", "280157286011511271533989422951", "897283893756127578322292118958"],
    ["3485198031263125658050790686801", "3352025175036927419876530203125", "2973056604120304522969999696491"],
    ["770558893884724598529533674937", "722328504495843807022833112153", "335511379427534311656710798968"],
    ["1577271624417732056618338337651", "1291637051908295587224621302305", "13564020148294776742944381452"],
    ["502535245393651877650828332721", "182141162869635425214823416737", "87988840834435229649551090334"],
    ["309990562161532629109378549703", "296584741425508269897752766319", "74916456162242222413936537236"],
    ["243513455644316518701642102143", "239771145220867991202203659549", "11900361514720697833561840495"],
    ["1201742566949757754899862890233", "641647860430765751458392375359", "341217881604209907874675821433"],
    ["507209718350630004049694027123", "184487185821747957740702302621", "63422596028358682971997977073"],
    ["469066560453237099419615679323", "420335640180846896361633610321", "318792603074051503529131980007"],
    ["3603193717203092917877506797763", "2330934552496643682346076072881", "2462962878231895456628444926931"],
    ["405421750182999546086416639213", "352664141381672526074673384969", "190482502633602522026716406210"],
    ["537403628975761650764156954993", "517214694290847882761450046499", "26995737547564296500405026625"],
    ["309945939017081359552445591591", "256216931276866843653727191713", "125965184859491501024252798356"],
    ["2117319396463620915099437881223", "1105376787388722496862806077385", "1190288137632174072573528855141"],
    ["1122198810262474384600312231187", "63748139006231344946621145973", "292017007173513613151239211267"],
    ["1644674509297606959628451803057", "997586802469912185830957414599", "550843275631403134960714469840"],
    ["75404363540366760439727901499", "33451835917331251417201445711", "32517816964116314719497361317"],
    ["73807430560852047360352292987", "38707316417589116492583653317", "19211261404195575283252447332"],
    ["1764776284484729897892738967891", "619104589685425039468374670087", "1319592008578141450291094904313"],
    ["2425742060723730952266324124559", "324709972887192578587817677057", "919206802719720879838473172161"],
    ["235776045139618218610341863683", "52020494195584045512061375287", "153276312000303685717028522325"],
    ["72399694682825837946927975157", "66583587191012908259630071497", "65408072063058019072253577314"],
    ["82226843075939372862059256271", "39574931997271565078938293107", "72299210235764206342642689453"],
    ["576465851348833980669060214423", "263373400824198297846758495363", "222695874265921322617697906073"],
    ["1309320295521959979486637519751", "710818076151030423063628477991", "1151643322579967235272288665179"],
    ["388073116243299719049697041059", "93774658102057243875664542319", "31310614758708575891098216049"],
    ["106171883841886625367977923841", "47953521058903799911249297975", "7236098763031435159742573134"],
    ["75332357154462380976079586039", "24639182129584606917471570503", "26752566085475942776180898092"],
    ["73764210312306688035707750563", "23526777810187440967780547753", "9502486013590286668593653859"],
    ["406701666106963162281904899119", "57927194748969572194379255821", "320154759777551452843644098149"],
    ["224251103908338188528711756183", "171879645203279162794009958633", "67407413582329338256717213300"],
    ["3991181910811876034905559121593", "2413311687709450222212161769949", "909935708517973157565471317180"],
    ["73928320426901978411951089411", "2402688671386997131627458187", "20011660086946308434694374791"],
    ["69736417863105965026610220973", "34275792357732740887562394731", "51083116293135572495621698283"]
    ]

function crack(N, E, SW) {
  console.log("Finding Q and P found")

  var N = new BigNumber(N)
    , E = new BigNumber(E)
    , SW = new BigNumber(SW)
    , PAndQ = crypto.pollard(N)
    , output = ""
    , temp = 0

    Fi = (PAndQ[0].minus(BigNumber.ONE)).times(PAndQ[1].minus(BigNumber.ONE))

    D = crypto.reverseNumber(E, Fi)
    Y = crypto.modPow(SW, D, N)

    output = intToString(Y)

    //console.log(Fi.toString())
    //console.log(D.toString())
    //console.log(output)

    return output
}

function intToString(num) {
  var output = ""
    , temp = 0
    , res = num.toString()

  for (i = 0; i < res.length; i = i + 2) {
    temp = parseInt(res[i] + res[i + 1])
    output += String.fromCharCode(temp + 1024)
  }

  return output
}

//console.log(intToString(196252))

//found = crack("69736417863105965026610220973", "34275792357732740887562394731", "51083116293135572495621698283")
//console.log(found)

module.exports = {
  codeToString: intToString
, crack: crack
}
